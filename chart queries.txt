/*
Using PostgreSQL, the dvd rental sample database, and Microsoft Excel I created a dashboard.
*/

/*
1. Query to obtain rentals by date. Then using Microsoft Excel to change the dates to days of the week for analysis
*/

SELECT DATE(rental_date) AS rental_date, COUNT(*) AS rental_count
FROM rental
GROUP BY DATE(rental_date)
ORDER BY rental_count DESC
LIMIT 50;

/*
2. Query for top ten revenue films
*/

SELECT film.title, SUM(payment.amount) AS total_revenue
FROM film
JOIN inventory ON film.film_id = inventory.film_id
JOIN rental ON inventory.inventory_id = rental.inventory_id
JOIN payment ON rental.rental_id = payment.rental_id
GROUP BY film.title
ORDER BY total_revenue DESC
LIMIT 10;

/*
3. Query for top ten customers revenue
*/

SELECT CONCAT(customer.first_name, ' ', customer.last_name) as customer_name, SUM(payment.amount) as total_revenue
FROM customer
INNER JOIN payment ON customer.customer_id = payment.customer_id
GROUP BY customer.customer_id
ORDER BY total_revenue DESC
LIMIT 10;

/*
4. Query for most rentals by customer
*/

SELECT CONCAT(customer.first_name, ' ', customer.last_name) as customer_name,
COUNT(rental.rental_id) AS rental_count, 
AVG(EXTRACT(DAY FROM RETURN_DATE - RENTAL_DATE)) AS average_rental_duration
FROM customer
JOIN rental ON customer.customer_id = rental.customer_id
GROUP BY customer.first_name, customer.last_name
ORDER BY rental_count DESC
LIMIT 10;

/*
5. Query film by rental count
*/

SELECT film.title, COUNT(rental.rental_id) AS rental_count
FROM film
JOIN inventory ON film.film_id = inventory.film_id
JOIN rental ON inventory.inventory_id = rental.inventory_id
GROUP BY film.title
ORDER BY rental_count DESC
LIMIT 10;

/*
6. Query films by rental duration
*/

SELECT film.title, AVG(EXTRACT(DAY FROM RETURN_DATE - RENTAL_DATE)) AS average_duration
FROM film
JOIN inventory ON film.film_id = inventory.film_id
JOIN rental ON inventory.inventory_id = rental.inventory_id
GROUP BY film.title
ORDER BY average_duration DESC
LIMIT 10;



